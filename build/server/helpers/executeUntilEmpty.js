// Generated by CoffeeScript 1.10.0
var executeUntilEmpty, log, sudo;

sudo = require('./sudo');

log = require('printit')();

module.exports = executeUntilEmpty = function(commands, config, callback) {
  var child, command, stderr;
  command = commands.shift();
  if (command[0] === 'cd') {
    config.cwd = command[1];
    return executeUntilEmpty(commands, config, callback);
  }
  child = sudo(config.user, config.cwd, command);
  stderr = '';
  child.stderr.setEncoding('utf8');
  child.stderr.on('data', function(data) {
    return stderr += data;
  });
  child.stdout.setEncoding('utf8');
  child.stdout.on('data', function(data) {
    return stderr += data;
  });
  return child.on('close', function(code) {
    if (code !== 0) {
      log.error(stderr);
      return callback(new Error((command.join(' ')) + " failed with code " + code));
    } else if (commands.length > 0) {
      return executeUntilEmpty(commands, config, callback);
    } else {
      return callback();
    }
  });
};
